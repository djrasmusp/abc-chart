<?php


namespace ACP\Base;

use ACP\Base\BaseController;

if ( ! class_exists( 'CustomPostTypes' ) ) {
	class CustomPostTypes extends BaseController {
		public function register() {
			if ( get_option( 'chart_settings', null ) !== null ) {
				add_action( 'init', array( $this, 'setCustomPostType' ) );
				add_action( 'init', array( $this, 'setCustomPostTypeTax' ) );
				add_action( 'init', array( $this, 'setTerms' ) );
				add_filter( 'post_type_link',
				            array( $this, 'changeCustomPostTypeUrl' ),
				            10,
				            3 );
				add_action( 'init',
				            array( $this, 'customPostTypeReWriteRules' ) );
				flush_rewrite_rules();
			}
		}

		function setCustomPostType() {
			$labels = array(
				'name'               => _x( 'ABC Charts',
				                            'post type general name' ),
				'singular_name'      => _x( 'Chart',
				                            'post type singular name' ),
				'add_new'            => _x( 'Add New Chart', 'chart' ),
				'add_new_item'       => __( 'Add New Chart' ),
				'edit_item'          => __( 'Edit Chart' ),
				'new_item'           => __( 'New Chart' ),
				'all_items'          => __( 'All Charts' ),
				'view_item'          => __( 'View Charts' ),
				'search_items'       => __( 'Search Charts' ),
				'not_found'          => __( 'No charts found' ),
				'not_found_in_trash' => __( 'No charts found in the Trash' ),
				'parent_item_colon'  => null,
				'menu_name'          => 'ABC Charts'
			);
			$args   = array(
				'labels'        => $labels,
				'public'        => true,
				'rewrite'       => array(
					'slug'       => 'hitlister/%cat%',
					'with_front' => false
				),
				'menu_position' => 20,
				'menu_icon'     => 'data:image/svg+xml;base64,'
				                   . base64_encode( '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path d="M262.41 227.94c3.55-.9 7.1-1.82 10.65-2.73l-5-6.83c-.94-1.28-1.87-2.56-2.81-3.84-1.07-1.49-2.23-3.11-3.82-4.15-1.66-1.09-3.35-1.43-5.59-1.43l-1.98.33c-1.55.41-3.11.81-4.66 1.22v.07h.07l12.63 17.46c.19-.03.35-.06.51-.1zM150.6 254.78c.9-.65 1.57-1.51 1.7-2.62.23-2.05-1.28-4.29-2.26-5.82-1.28-2.01-2.88-4.34-5.02-5.6-1.69-.99-3-1.14-5.09-1.33-.28.1-.65.06-.96.08l-1.77.24c-1.9.32-3.7.91-5.54 1.38-.5.12-1.24.18-1.65.49-.02.02-.04.05-.06.07 0 .05.01.1.01.15.16.61.86 1.41 1.22 1.96.96 1.48 1.92 2.95 2.88 4.43 1.53 2.36 3.06 4.71 4.59 7.07.41.63.82 1.26 1.22 1.89.17.25.35.65.62.82.27.17 6.7-1.68 7.47-1.94.92-.31 1.85-.7 2.64-1.27zM212.16 250.81l1.48-.42c2.34-.66 4.67-1.33 7.01-2 .09-.04.15-.03.15-.14-.77-.58-1.46-1.35-2.16-2.05-1.04-1.02-2.09-2.04-3.14-3.06-2.76-2.68-5.52-5.35-8.28-8.03l-3-2.91c-.31-.26-.57-.58-.91-.78.08.58.39 1.16.61 1.68.29.74.59 1.48.89 2.21 1.52 3.81 3.04 7.63 4.56 11.44.42 1.03.83 2.07 1.25 3.1.08.21.16.43.23.64l.42.6c.3-.08.6-.18.89-.28zM364.33 212.36c-1.32-1.68-2.64-3.37-3.96-5.05-3.08-3.92-6.16-7.85-9.25-11.77-.88-1.12-1.75-2.24-2.63-3.35-1.22-1.52-2.09-2.81-3.77-3.9-.8-.52-1.76-.85-2.72-1.03l-1.62-.18c-.49.06-.97.13-1.46.18-1.56.37-3.51 1.17-3.48 3.14.03 1.82 2.03 3.83 3.1 5.22.85 1.09 1.7 2.19 2.55 3.28l10.66 13.69c.68.87 1.36 1.74 2.03 2.61 1 1.21 1.87 2.45 3.21 3.35 1.64 1.11 3.21 1.28 5.38 1.28.17-.02.35-.05.52-.07.44-.14.87-.27 1.31-.41 1.5-.62 2.65-1.87 2.2-3.71-.3-1.28-1.29-2.23-2.07-3.28z"/>
<path fill="black" d="M505.74 197.43c-.42-3.38-1.01-6.75-1.82-10.06-.68-2.8-1.69-5.52-2.64-8.24-.7-2-1.56-3.95-2.31-5.94-.51-1.37-1.01-2.75-1.54-4.12-.09-.22-.18-.43-.32-.63-.19-.27-.39-.54-.64-.77a3.68 3.68 0 00-.82-.58c-.25-.14-.52-.25-.8-.31a5.66 5.66 0 00-1.16-.14c-.23-.01-.45.04-.68.08-.15.03-.3.08-.45.12-8.23 1.65-16.47 3.28-24.7 4.93-.14.03-.27.05-.41.08-.12.02-.24.03-.36.06-.2.06-.41.12-.61.2-.18.07-.35.16-.51.26-.18.12-.36.24-.52.39-.19.17-.37.36-.52.56-.15.19-.28.41-.4.63-.1.18-.16.38-.24.58-.04.11-.08.23-.11.35-.04.18-.06.35-.08.53-.01.12-.01.24 0 .36.01.2.03.39.05.59a4.646 4.646 0 00.22.8c.05.13.13.25.17.38.12.35.24.71.34 1.07.25.88.47 1.76.69 2.64.21.82.42 1.63.59 2.46.15.72.27 1.44.36 2.16.11.95.2 1.89.24 2.85.04 1.14.07 2.3 0 3.44-.07 1.06-.19 2.13-.41 3.17-.22 1.03-.5 2.05-.89 3.02-.5 1.28-1.1 2.53-1.77 3.74-.51.91-1.08 1.8-1.77 2.58-.9 1.02-1.93 1.92-2.95 2.82-.84.74-1.73 1.41-2.63 2.08-.57.42-1.17.81-1.77 1.18-1.05.65-2.09 1.33-3.19 1.9-1.19.62-2.4 1.19-3.66 1.66-1.23.46-2.5.82-3.78 1.1-2.12.46-4.26.84-6.41 1.1-1.61.19-3.24.25-4.87.27-1.78.01-3.57 0-5.34-.18a35.13 35.13 0 01-4.78-.83c-1.55-.38-3.09-.85-4.58-1.42-2.19-.84-4.36-1.76-6.46-2.82-2.02-1.01-3.97-2.16-5.87-3.38a91.056 91.056 0 01-6.17-4.33c-1.7-1.3-3.35-2.67-4.93-4.12-2.03-1.86-4.03-3.75-5.87-5.78-1.63-1.8-3.11-3.73-4.55-5.69-1.38-1.89-2.65-3.85-3.9-5.84-1.23-1.97-2.38-3.99-3.51-6.02-.43-.76-.83-1.54-1.18-2.34-.81-1.85-1.66-3.69-2.3-5.6-.66-1.96-1.22-3.96-1.62-5.99-.4-2.03-.65-4.1-.77-6.16-.12-2.17-.13-4.36.06-6.52.19-2.19.38-4.43 1.06-6.52.65-2.01 1.72-3.88 2.89-5.63.76-1.14 1.81-2.06 2.83-2.96.76-.68 1.63-1.22 2.49-1.76.52-.34 1.1-.59 1.65-.88 1.81-.97 3.82-1.57 5.82-2.05 1.91-.46 3.89-.68 5.86-.76 1.91-.08 3.84.04 5.74.28 1.87.24 3.74.58 5.54 1.16 1.78.58 3.52 1.36 5.13 2.33 1.78 1.07 3.35 2.45 4.97 3.73.63.5 1.23 1.04 1.8 1.61 1.79 1.78 3.53 3.62 5.3 5.43.19.19.43.34.67.46.34.18.69.35 1.07.43.38.09.78.09 1.17.11.15 0 .3-.03.45-.06 12.25-2.51 24.49-5.04 36.74-7.57.15-.03.31-.07.45-.13.24-.1.49-.21.71-.35.2-.12.4-.26.57-.42.23-.22.45-.45.63-.72.2-.29.4-.6.5-.94.14-.51.23-1.04.18-1.57-.05-.54-.23-1.07-.47-1.56-.17-.35-.44-.64-.72-.9-13.35-12.9-26.78-25.73-40.17-38.6l-.41-.35c-.21-.18-.46-.29-.7-.42-.12-.06-.24-.11-.36-.14-.24-.07-.47-.14-.71-.17-.26-.04-.53-.03-.79-.03-.06 0-.13.01-.19.01-.1.01-.19.03-.28.04-11.83 2.15-23.66 4.27-35.48 6.44-.29.05-.59.16-.87.3-.44.22-.83.52-1.16.88-.32.35-.58.78-.75 1.23-.18.48-.29.99-.27 1.5.02.52.16 1.05.37 1.52.2.45.49.88.87 1.2l.82.68c-.55-.26-1.08-.53-1.63-.77-.54-.24-1.08-.47-1.63-.68-.59-.23-1.17-.48-1.77-.65-1.97-.56-3.92-1.24-5.94-1.56-2.71-.42-5.45-.68-8.19-.64-2.67.04-5.35.39-7.97.88a50.62 50.62 0 00-7.45 2.02c-2.1.75-4.18 1.62-6.07 2.8-4 2.48-8.04 4.99-11.55 8.13-3.78 3.39-7.04 6.74-9.51 11.48-1.58 3.04-3.55 5.91-4.7 9.13-1.65 4.6-2.84 9.39-3.67 14.21-.65 3.78-.8 7.65-.75 11.48.05 4 .38 8.01 1.03 11.95.7 4.26 1.8 8.46 3.01 12.61.98 3.36 1.98 6.76 3.58 9.88l1.6 3.14c-1.19-.85-2.04-1.32-3.39-1.91-.9-.39-1.81-.77-2.73-1.15-.49-.2-.97-.43-1.48-.57-1.77-.5-3.54-1.07-5.36-1.36-2.03-.31-4.09-.45-6.14-.42-1.95.02-3.9.31-5.84.55-1.6.2-3.19.48-4.77.77-1.29.24-2.15.44-2.67.67.13-.11.27-.2.4-.31.1-.09.19-.2.28-.3l1.95-2.19c1.22-1.73 2.61-3.34 3.65-5.17 1.03-1.8 1.92-3.71 2.56-5.69.73-2.25 1.18-4.59 1.52-6.93.19-1.32.13-2.66.05-3.99-.13-2.03-.34-4.07-.71-6.07-.26-1.38-.67-2.73-1.19-4.03-.8-2.03-1.75-4-2.75-5.93-.69-1.33-1.43-2.64-2.32-3.84-1.66-2.25-3.32-4.53-5.31-6.5-1.89-1.87-4.04-3.48-6.26-4.93-3.15-2.05-6.37-4.06-9.82-5.55-3.34-1.45-6.89-2.39-10.44-3.23-4.79-1.13-9.63-2.1-14.52-2.66-3.46-.39-6.96-.2-10.44-.19-2.37.01-4.75.05-7.12.24-5.13.4-10.29.69-15.37 1.52-28.93 4.73-57.75 10.1-86.63 15.16-.06.01-.11.03-.17.05-.07.02-.15.04-.22.07-.2.07-.4.15-.59.24-.19.09-.37.2-.55.31l-.21.15c-.16.13-.33.26-.48.41-.18.18-.34.37-.49.57-.16.22-.31.44-.43.68-.1.18-.17.38-.23.57-.07.23-.14.46-.18.7-.05.25-.07.51-.08.77-.01.15 0 .3.02.45.04.27.08.54.14.81.03.13.07.26.12.38.1.25.21.5.34.74.09.16.19.31.3.45 6.46 8.76 12.91 17.51 19.38 26.26.08.11.17.2.26.3a3.792 3.792 0 00.75.64c.15.1.3.2.46.29.15.09.31.17.47.23.18.07.36.12.54.17.2.05.4.07.6.1.23.03.46.06.69.06.25 0 .5-.04.75-.07.19-.03.37-.07.55-.11 2.31-.44 4.62-.89 6.93-1.33.13-.02.25-.05.37-.07.12-.02.23-.03.35-.03.13-.01.27-.01.4-.01.17 0 .35 0 .51.03.21.02.41.06.6.11.21.06.41.14.61.22.19.07.38.15.55.25.19.11.37.24.55.38a4.553 4.553 0 01.85.84c.1.12.2.26.29.39l29.58 42c-.06-.16-.11-.33-.17-.49-.35-.99-.69-1.98-1.04-2.97-.03-.09-.16-.28-.03-.28.54-.34 1.57-.45 2.21-.61l3.76-.96c.62-.14 1.23-.28 1.85-.43v-.07c.71.14 1.73 1.37 2.31 1.89l8.19 7.53c9.28 8.52 18.57 17.05 27.84 25.57 3 2.76 6 5.52 8.99 8.28.36.3 2.55 2.48 2.76 2.48v.07h-.07c-.66.38-1.61.55-2.36.75l-4.49 1.35-2.67.78c-.58-.78-1.46-1.48-2.16-2.13-.78-.73-1.57-1.54-2.33-2.25-1.51-1.47-3.02-2.93-4.53-4.4-.4-.38-.8-.76-1.2-1.15l-.27-.12c-.58-.06-1.87.46-2.44.63-2.93.85-5.85 1.71-8.78 2.56 6.51 9.25 13.03 18.5 19.55 27.75.16.22.33.45.44.7.13.28.23.59.29.9.07.42.09.85.09 1.28 0 .26-.04.51-.11.76-.09.37-.2.74-.37 1.08-.17.34-.39.65-.64.93-.26.29-.55.57-.87.79-.32.22-.68.37-1.02.53-.12.06-.25.09-.38.14-2.83.93-5.65 1.89-8.49 2.79-.23.07-.48.1-.73.12-.28.03-.56.06-.84.05-.31-.01-.61-.03-.91-.11-.3-.07-.59-.19-.87-.32-.23-.11-.46-.24-.67-.38-.2-.14-.38-.31-.56-.47-.12-.1-.23-.2-.34-.3-47.29-46.37-94.57-92.75-141.86-139.12-.14-.14-.28-.28-.44-.4-.16-.13-.33-.24-.51-.35-.19-.11-.38-.23-.59-.31-.25-.1-.51-.17-.78-.23-.26-.06-.53-.12-.8-.13-.3-.01-.6.03-.89.05-.09.01-.18.02-.27.04-21.11 3.9-42.23 7.78-63.34 11.7-.17.03-.34.07-.5.13-.24.08-.48.15-.7.27-.24.12-.47.28-.69.45-.26.2-.5.43-.73.67-.18.19-.34.41-.48.63-.17.28-.32.58-.43.89-.12.31-.2.64-.25.97-.04.22-.03.45-.03.67 0 .2.03.4.05.59l20.24 187.49.05.55-.07 1.1-.34 1.12-.5.96-.96 1.01-1.23.85-1.03.43-1.69.6-.82.34-.84.6-.62.62-.55.78-.48.99-.3 1.35.02 1.03.25 1.17 21.26 46.63c.08.17.16.34.26.51.07.12.15.24.23.36.06.08.12.16.19.24.1.12.2.26.31.37.14.15.28.29.44.43.13.11.27.22.41.31.19.13.37.26.57.37.22.13.46.23.7.33.2.08.4.15.61.2.28.07.56.13.85.16.28.03.57.03.86.03.2-.01.39-.03.59-.06.21-.03.43-.07.63-.13.27-.08.53-.17.79-.27 25.18-9.93 50.37-19.85 75.55-29.79.22-.09.44-.18.64-.3.29-.17.56-.38.83-.59.23-.18.47-.37.66-.58.23-.25.44-.53.61-.83.2-.35.37-.73.51-1.12.11-.34.19-.69.24-1.04.05-.39.08-.78.05-1.17-.02-.36-.09-.72-.19-1.07-.09-.32-.24-.62-.37-.93-.07-.16-.13-.32-.21-.48-7.07-13.69-14.15-27.37-21.22-41.06l-.15-.3c-.11-.19-.21-.38-.34-.56-.13-.19-.26-.38-.41-.55-.16-.19-.34-.38-.53-.55-.16-.15-.33-.28-.5-.41-.13-.1-.28-.18-.42-.26-.26-.14-.52-.28-.79-.38-.26-.1-.54-.17-.81-.23-.19-.04-.37-.07-.56-.09-.19-.02-.39-.03-.59-.02a6.317 6.317 0 00-1.38.18c-.16.04-.31.09-.47.15-.24.08-.48.18-.73.27-.17.06-.34.11-.51.16-.2.05-.41.11-.61.14-.22.03-.44.04-.66.04-.26 0-.52-.01-.78-.04-.14-.01-.27-.04-.41-.07-.26-.06-.52-.12-.77-.22-.27-.1-.53-.22-.78-.36a4.45 4.45 0 01-.68-.45c-.22-.17-.43-.35-.62-.56-.19-.2-.35-.41-.51-.63-.16-.24-.32-.48-.45-.74-.12-.24-.22-.48-.3-.74-.07-.21-.1-.44-.15-.66-1.3-6.24-2.61-12.47-3.9-18.71-.04-.21-.07-.43-.09-.64-.02-.2-.06-.4-.06-.61.01-.26.05-.51.1-.77.05-.27.11-.53.19-.79.1-.31.22-.62.37-.9s.35-.54.55-.79c.2-.25.41-.51.64-.73.23-.21.48-.41.74-.57.3-.18.63-.32.96-.45.19-.08.39-.12.59-.18 19.97-6.62 39.93-13.27 59.91-19.87-.56-.92-1.22-1.86-1.79-2.7-1.43-2.21-2.85-4.43-4.28-6.64-6.58-10.22-13.15-20.45-19.73-30.67-2.12-3.29-4.23-6.59-6.35-9.89-.63-.99-1.26-1.97-1.9-2.96-.05-.08-.06-.21-.17-.21.05-.06.05-.07.15-.07.56-.15 1.13-.3 1.69-.46 1.16-.3 2.31-.59 3.47-.89 3.02-.76 6.05-1.53 9.08-2.29 1.06-.27 2.12-.54 3.17-.81.54-.14 1.1-.35 1.7-.35.32-.16.79-.22 1.18-.22.24-.13.59-.15.89-.15.15-.03.29-.05.44-.07.2-.03.39-.05.59-.07.19-.09.5-.07.74-.07l.88-.15c1.11 0 2.21.01 3.32.01 2.27.11 4.58.51 6.55 1.28 1.1.43 2.21.88 3.24 1.47 4.06 2.35 7.39 6 9.8 9.97 1.17 1.93 2.28 4.14 2.39 6.59.11 2.25-.49 3.95-1.54 5.6-.19.3-1.92 2.21-1.92 2.29.58.24 1.06.78 1.57 1.15 1.4 1.08 2.81 2.16 4.21 3.24 4.83 3.71 9.66 7.42 14.48 11.13 1.92 1.48 3.84 2.95 5.76 4.43.22.16 1.15 1 1.35 1v.15h-.15c-2.77.84-5.55 1.69-8.32 2.53-.49.15-2.13.77-2.56.68-.38-.08-1.09-.81-1.43-1.08-1.02-.82-2.04-1.64-3.06-2.47-4.01-3.23-8.01-6.45-12.02-9.67l-5.81-4.67c-.89-.64-1.67-1.55-2.62-2.08-.09-.05-.11-.01-.11-.13-1.94.54-3.88 1.09-5.83 1.63-.13.03-.59.08-.59.21 5.04 7.75 10.08 15.49 15.12 23.24h-.07c-.74.39-1.65.53-2.45.78l-4.19 1.26c.28.13.56.26.82.44.27.18.51.4.74.63 4.92 4.94 9.84 9.88 14.75 14.84.28.28.59.54.81.88.25.37.44.79.58 1.21.15.47.26.96.29 1.45.03.51-.02 1.03-.14 1.53-.13.55-.32 1.1-.61 1.59-.3.5-.69.95-1.13 1.33-.37.32-.82.56-1.27.75-1.23.5-2.51.86-3.76 1.3-.23.08-.45.17-.67.27-.17.08-.34.16-.49.26-.2.13-.39.27-.58.41-.13.1-.26.21-.37.33a6.038 6.038 0 00-.88 1.09c-.12.19-.21.4-.3.61-.08.19-.16.37-.22.56-.08.26-.15.53-.19.81-.03.18-.04.37-.05.56-.01.16-.03.31-.02.47.02.29.05.59.11.88.05.29.13.57.23.84.07.19.16.37.25.55.1.2.22.39.34.58 7.61 12.55 15.23 25.09 22.84 37.63.05.08.09.16.14.24.07.12.15.24.23.36.1.14.2.27.31.4.11.13.22.27.34.39.22.21.46.4.71.58.19.14.38.27.59.38.24.13.49.24.75.34.23.09.46.15.7.21.26.06.52.12.78.14.28.03.56.03.84.01.28-.01.56-.04.83-.1.33-.07.66-.17.97-.3 49.77-19.66 99.55-39.32 149.32-58.97 1.85-.73 3.7-1.44 5.55-2.19 1.58-.63 3.17-1.25 4.72-1.94 1.19-.53 2.35-1.13 3.5-1.73.44-.23.87-.49 1.29-.76 1.63-1.07 3.35-2 4.84-3.25 1.79-1.5 3.39-3.21 4.95-4.95 1.25-1.4 2.46-2.86 3.46-4.45.98-1.56 1.73-3.26 2.47-4.95.64-1.45 1.16-2.95 1.65-4.45.5-1.52 1.02-3.05 1.32-4.62.36-1.9.45-3.85.66-5.77.18-1.59.36-3.19.49-4.78.04-.45.04-.9.04-1.35 0-.63.02-1.26-.04-1.88l-.1-1.11c.21.13.41.29.64.4.75.37 1.51.72 2.28 1.04 1.07.45 2.15.85 3.22 1.28 2.35.94 4.67 1.96 7.05 2.82 2.64.95 5.29 1.9 8.01 2.6 2.98.77 6.03 1.29 9.07 1.81 3.39.58 6.79 1.26 10.22 1.48 3.29.22 6.61.12 9.89-.17 4.97-.43 9.93-1.11 14.84-1.98 4.99-.89 9.95-1.98 14.84-3.3 4.08-1.1 8.13-2.35 12.03-3.96 3.7-1.53 7.23-3.47 10.72-5.44 2.84-1.61 5.69-3.24 8.25-5.28 2.1-1.67 3.91-3.69 5.6-5.77 2-2.44 3.84-5.03 5.44-7.75 1.77-3.01 3.36-6.14 4.62-9.4 1.06-2.76 1.69-5.68 2.31-8.57.7-3.27 1.48-6.55 1.65-9.89.19-3.37-.23-6.74-.64-10.08zm-391.43 55.95c.03.31.02.64 0 .95-.01.26-.04.53-.1.78-.07.31-.16.62-.29.9-.18.37-.39.73-.64 1.06-.21.29-.47.54-.72.78-.24.22-.49.43-.76.61-.22.14-.47.24-.71.35-.19.08-.37.15-.57.2-10.47 2.91-20.95 5.79-31.42 8.69-.37.1-.73.25-1.11.32-.48.09-.98.16-1.47.14-.52-.03-1.04-.14-1.54-.29-.42-.13-.83-.3-1.19-.54-.38-.25-.71-.59-1.02-.93-.3-.33-.55-.71-.79-1.09-.13-.21-.23-.45-.31-.68-.09-.25-.16-.51-.23-.77-.07-.29-.11-.59-.17-.88-4.91-22.61-9.83-45.22-14.74-67.83l55.55 54.37c.26.26.57.47.83.75.18.19.31.41.47.62.13.19.28.37.38.57.14.29.25.6.34.92.1.31.18.65.21 1zm119.88-52.49c-.36-.01-.72-.05-1.08-.12-.3-.06-.61-.15-.89-.27-.29-.12-.56-.28-.82-.44-.23-.14-.44-.3-.65-.47-.16-.13-.3-.28-.44-.42-.08-.08-.16-.16-.23-.25-.08-.09-.15-.19-.23-.29-6-7.81-11.99-15.63-17.99-23.44-.17-.23-.36-.45-.53-.68-.11-.16-.22-.33-.3-.51-.13-.26-.25-.53-.36-.81-.08-.21-.15-.44-.19-.66-.05-.22-.07-.45-.09-.67-.01-.22-.01-.43 0-.65.01-.19.03-.39.06-.58.04-.27.08-.54.16-.8.1-.29.24-.57.38-.84.12-.22.24-.44.39-.65.15-.21.32-.42.49-.6a6.168 6.168 0 011.09-.87c.22-.13.45-.25.68-.36.24-.11.49-.19.75-.27.16-.05.33-.06.5-.1.14-.03.28-.06.42-.08 5.64-1.07 11.29-2.14 16.93-3.2 1.3-.24 2.59-.51 3.89-.71 1.03-.16 2.06-.38 3.1-.37 1.37.01 2.74.12 4.08.41 1.95.42 3.89.93 5.72 1.72 1.87.81 3.62 1.89 5.31 3.03 1.25.85 2.41 1.85 3.48 2.92.94.94 1.81 1.97 2.51 3.1.64 1.05 1.08 2.23 1.46 3.41.43 1.33.74 2.7.93 4.08.19 1.35.29 2.72.23 4.08-.05 1.07-.29 2.14-.56 3.18-.23.91-.53 1.81-.94 2.66-.34.71-.78 1.37-1.27 1.98-.51.64-1.07 1.26-1.72 1.76-.67.52-1.44.91-2.21 1.27-.66.3-1.36.53-2.06.71-5.93 1.54-11.88 2.97-17.82 4.45-.15.04-.31.08-.46.11-.29.07-.58.16-.87.21-.27.02-.56.04-.85.03zm89.45 55.84c-.42 1.53-1.22 2.96-2.21 4.2-.95 1.19-2.24 2.08-3.5 2.95-.55.38-1.24.52-1.88.74-1.93.66-3.88 1.27-5.82 1.91-6.24 2.06-12.47 4.13-18.71 6.19-.16.05-.32.1-.48.14-.18.05-.36.11-.55.14-.25.04-.51.05-.76.05a7.45 7.45 0 01-.94-.08c-.3-.05-.61-.14-.9-.23-.25-.08-.49-.19-.71-.32a5.507 5.507 0 01-1.48-1.13c-.13-.14-.24-.3-.36-.44-.04-.06-.08-.12-.13-.18l-12.48-16.29c-.88.29-1.94.62-2.26.54-.34-.09-1.15-1.37-1.35-1.68l-5.18-7.22-18.36-25.53c-2.54-3.55-5.09-7.1-7.64-10.65-.28-.37-2.34-3.3-2.38-3.3.05-.06.07-.05.07-.15 1.44-.19 2.82-.69 4.2-1.03 2.36-.6 4.72-1.19 7.08-1.79.74-.19 1.48-.37 2.22-.56.5-.12 1-.31 1.55-.31.24-.13.59-.15.89-.15.15-.03.29-.05.44-.07.22-.03.44-.05.66-.07.2-.02.39-.05.59-.07l1.03-.15c2.29 0 4.32.13 6.34.54 3.52.71 6.87 2.47 9.5 4.94 1.01.95 1.98 1.95 2.79 3.03.53.73 1.07 1.45 1.6 2.18 1.19 1.62 2.38 3.24 3.57 4.85 1.31 1.77 2.61 3.54 3.92 5.32.17-.03.35-.08.52-.1 1.66-.26 3.33-.49 5.01-.55 2.23-.08 4.48-.11 6.7.11 2.19.22 4.36.63 6.48 1.22 1.81.5 3.58 1.2 5.27 2.03 1.45.71 2.82 1.6 4.13 2.54 2.07 1.48 4.19 2.93 6 4.71 1.67 1.63 3.1 3.5 4.38 5.45 1.02 1.56 1.88 3.24 2.47 5.01.71 2.16 1.29 4.4 1.4 6.67.12 2.18-.14 4.45-.73 6.59zm8.42-20.21c-.64.2-1.28.41-1.91.61-1.48.44-2.95.88-4.43 1.33-.62.19-1.23.38-1.85.58-.2-.37-.49-.68-.74-1.03l-1.74-2.31c-1.87-2.48-3.74-4.97-5.61-7.45-5.78-7.68-11.55-15.36-17.33-23.04l-8.04-10.71c.5-.15 1.16-.29 2.02-.45 1.58-.29 3.17-.57 4.77-.77.66-.08 1.32-.17 1.99-.25 2.03 2.67 4.06 5.34 6.08 8.02 6.27 8.27 12.54 16.53 18.81 24.79 2.2 2.92 4.41 5.83 6.61 8.75.19.27 1.44 1.77 1.44 1.95-.03-.02-.05-.02-.07-.02zm40.7-12.57c-2.36 1.96-5.42 2.61-8.69 2.77-5.47.26-10.77-1.82-14.51-5.13-1.51-1.34-2.67-2.88-3.85-4.41-1.06-1.38-2.12-2.75-3.18-4.12-2.77-3.58-5.53-7.16-8.3-10.74l-3.76-4.87c-1.58-2.04-3.21-3.94-3.99-6.39-1.46-4.61 1.67-7.79 5.4-9.32.88-.36 1.94-.78 2.97-.78.23-.13.59-.15.89-.15.24-.05.49-.1.74-.15 1.36 0 2.76-.04 4.06.09 5.04.49 9.78 2.8 13.22 6.46.65.69 1.22 1.46 1.79 2.2 1.23 1.55 2.45 3.1 3.68 4.65 3.33 4.22 6.67 8.43 10 12.65l2.44 3.1c1.19 1.44 2.36 2.92 3.15 4.59 1.67 3.54.91 7.08-2.06 9.55z"/>
</svg>' ),
				'supports'      => array( 'title', 'editor', 'thumbnail' ),
				'has_archive'   => false
			);

			register_post_type( 'chart', $args );
		}

		function setCustomPostTypeTax() {
			$labels = array(
				'name'          => _x( 'Chart Types',
				                       'taxonomy general name' ),
				'singular_name' => _x( 'Chart Type',
				                       'taxonomy singular name' )
			);

			$args = array(
				'labels'       => $labels,
				'hierarchical' => true,
				'public'       => false,
				'rewrite'      => array(
					'slug'       => 'projects',
					'with_front' => false
				)
			);
			register_taxonomy( 'chart_type', 'chart', $args );
		}

		function setTerms() {
			foreach ( $this->plugin_terms as $term ) {
				wp_insert_term( $term['term'],
				                'chart_type',
				                array( 'slug' => $term['slug'] ) );
			}
		}

		function changeCustomPostTypeUrl( $post_link, $id = 0 ) {
			$post = get_post( $id );
			if ( $post->post_type == 'chart' ) {
				if ( is_object( $post ) ) {
					$terms = wp_get_object_terms( $post->ID, 'chart_type' );
					if ( $terms ) {
						$cpt_url = home_url( 'hitlister/%cat%/' . $post->ID . '/' );

						return str_replace( array( '%cat%', '%post_id%*' ),
						                    array( $terms[0]->slug, $post->ID ),
						                    $cpt_url );
					}
				}
			}

			return $post_link;
		}

		function customPostTypeReWriteRules() {
			add_rewrite_tag( '%cat%', '(.+)' );
			add_rewrite_rule( 'hitlister/(.+)/([0-9]+)?$',
			                  'index.php?post_type=chart&p=$matches[2]',
			                  'top' );
		}
	}
}
